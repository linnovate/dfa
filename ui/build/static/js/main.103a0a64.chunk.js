(this["webpackJsonpcreate-daml-app"]=this["webpackJsonpcreate-daml-app"]||[]).push([[0],{296:function(e,t,n){},304:function(e,t){},306:function(e,t){},316:function(e,t){},318:function(e,t){},34:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(403);t.User=r,t.packageId="91976a336dda8ea60d0e859ce793eb7e8e348f02cf1d03d7228aaa62de6daa89"},345:function(e,t){},347:function(e,t){},348:function(e,t){},353:function(e,t){},355:function(e,t){},361:function(e,t){},363:function(e,t){},382:function(e,t){},394:function(e,t){},397:function(e,t){},403:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(404))},404:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(95),c=n(143),a=(n(86),n(405));t.Request={templateId:"91976a336dda8ea60d0e859ce793eb7e8e348f02cf1d03d7228aaa62de6daa89:User:Request",keyDecoder:c.lazyMemo((function(){return r.constant(void 0)})),keyEncode:function(){throw"EncodeError"},decoder:c.lazyMemo((function(){return r.object({sender:c.Party.decoder,receiver:c.Party.decoder,content:c.Text.decoder})})),encode:function(e){return{sender:c.Party.encode(e.sender),receiver:c.Party.encode(e.receiver),content:c.Text.encode(e.content)}},Archive:{template:function(){return t.Request},choiceName:"Archive",argumentDecoder:c.lazyMemo((function(){return a.DA.Internal.Template.Archive.decoder})),argumentEncode:function(e){return a.DA.Internal.Template.Archive.encode(e)},resultDecoder:c.lazyMemo((function(){return c.Unit.decoder})),resultEncode:function(e){return c.Unit.encode(e)}}},c.registerTemplate(t.Request),t.SendRequest={decoder:c.lazyMemo((function(){return r.object({sender:c.Party.decoder,content:c.Text.decoder})})),encode:function(e){return{sender:c.Party.encode(e.sender),content:c.Text.encode(e.content)}}},t.User={templateId:"91976a336dda8ea60d0e859ce793eb7e8e348f02cf1d03d7228aaa62de6daa89:User:User",keyDecoder:c.lazyMemo((function(){return c.lazyMemo((function(){return c.Party.decoder}))})),keyEncode:function(e){return c.Party.encode(e)},decoder:c.lazyMemo((function(){return r.object({username:c.Party.decoder})})),encode:function(e){return{username:c.Party.encode(e.username)}},Archive:{template:function(){return t.User},choiceName:"Archive",argumentDecoder:c.lazyMemo((function(){return a.DA.Internal.Template.Archive.decoder})),argumentEncode:function(e){return a.DA.Internal.Template.Archive.encode(e)},resultDecoder:c.lazyMemo((function(){return c.Unit.decoder})),resultEncode:function(e){return c.Unit.encode(e)}},SendRequest:{template:function(){return t.User},choiceName:"SendRequest",argumentDecoder:c.lazyMemo((function(){return t.SendRequest.decoder})),argumentEncode:function(e){return t.SendRequest.encode(e)},resultDecoder:c.lazyMemo((function(){return c.ContractId(t.Request).decoder})),resultEncode:function(e){return c.ContractId(t.Request).encode(e)}}},c.registerTemplate(t.User)},405:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(406);t.DA=r,t.packageId="d14e08374fc7197d6a0de468c968ae8ba3aadbf9315476fd39071831f5923662"},406:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(407);t.Internal=r},407:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(408);t.Template=r},408:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(409))},409:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(95),c=n(143);n(86);t.Archive={decoder:c.lazyMemo((function(){return r.object({})})),encode:function(e){return{}}}},543:function(e,t,n){"use strict";n.r(t);var r,c,a=n(0),o=n.n(a),s=n(56),u=n.n(s),i=(n(295),n(296),n(45)),d=n(47),l=n.n(d),f=n(87),j=n(557),p=n(558),m=n(553),b=n(559),h=n(555),O=n(264);!function(e){e[e.DEV=0]="DEV",e[e.PROD_DABL=1]="PROD_DABL",e[e.PROD_OTHER=2]="PROD_OTHER"}(c||(c={}));var v=window.location.hostname.endsWith(".projectdabl.com")?c.PROD_DABL:c.PROD_OTHER,y=v===c.PROD_DABL?window.location.hostname.split(".")[0]:null!==(r="create-daml-app-sandbox")?r:"create-daml-app-sandbox",x=v===c.PROD_DABL?"https://api.projectdabl.com/data/".concat(y,"/"):void 0;var g=function(e){return{party:e,token:function(e){var t={"https://daml.com/ledger-api":{ledgerId:y,applicationId:"create-daml-app",actAs:[e]}};return Object(O.encode)(t,"secret","HS256")}(e),ledgerId:y}},D=n(86),P=n.n(D),w=n(34),R=n(8),k=function(e){var t=e.onLogin,n=o.a.useState(""),r=Object(i.a)(n,2),s=r[0],u=r[1],d=Object(a.useCallback)(function(){var e=Object(f.a)(l.a.mark((function e(n){var r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new P.a({token:n.token,httpBaseUrl:x}),e.next=4,r.fetchByKey(w.User.User,n.party);case 4:if(null!==e.sent){e.next=10;break}return c={username:n.party,following:[]},e.next=9,r.create(w.User.User,c);case 9:e.sent;case 10:t(n),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),alert("Unknown error:\n".concat(e.t0));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),[t]),O=function(){var e=Object(f.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=g(s),e.next=4,d(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){var e=new URL(window.location.toString()),t=e.searchParams.get("token");if(null!==t){var n=e.searchParams.get("party");if(null===n)throw Error("When 'token' is passed via URL, 'party' must be passed too.");e.search="",window.history.replaceState(window.history.state,"",e.toString()),d({token:t,party:n,ledgerId:y})}}),[d]),Object(R.jsx)(j.a,{textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(R.jsxs)(j.a.Column,{style:{maxWidth:450},children:[Object(R.jsx)(p.a,{as:"h1",textAlign:"center",size:"huge",style:{color:"#223668"},children:Object(R.jsx)(p.a.Content,{children:"Distrubuted Flight Approval"})}),Object(R.jsx)(m.a,{size:"large",className:"test-select-login-screen",children:Object(R.jsx)(b.a,{children:v!==c.PROD_DABL?Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(m.a.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username",value:s,className:"test-select-username-field",onChange:function(e){return u(e.currentTarget.value)}}),Object(R.jsx)(h.a,{primary:!0,fluid:!0,className:"test-select-login-button",onClick:O,children:"Log in"})]}):Object(R.jsx)(h.a,{primary:!0,fluid:!0,onClick:function(){window.location.assign("https://login.projectdabl.com/auth/login?ledgerId=".concat(y))},children:"Log in with DABL"})})})]})})},U=n(556),A=n(551),_=n(46),S=n(552),q=n(26),I=n.n(q),M=n(560),E=n(166),L=function(){return Object(R.jsx)(M.a,{relaxed:!0,children:Object(q.useStreamQuery)(w.User.Request).contracts.map((function(e){var t=e.payload,n=t.sender,r=t.receiver,c=t.content;return Object(R.jsxs)(E.a,{className:"select-request-item",children:[Object(R.jsxs)("strong",{children:[n," \u2192 ",r,":"]})," ",c]},e.contractId)}))})},T=function(e){var t=e.admins,n=Object(q.useParty)(),r=o.a.useState(),c=Object(i.a)(r,2),a=c[0],s=c[1],u=o.a.useState(""),d=Object(i.a)(u,2),j=d[0],p=d[1],b=o.a.useState(!1),O=Object(i.a)(b,2),v=O[0],y=O[1],x=Object(q.useLedger)(),g=function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.preventDefault(),void 0!==a){e.next=4;break}return e.abrupt("return");case 4:return y(!0),e.next=7,x.exerciseByKey(w.User.User.SendRequest,a,{sender:n,content:j});case 7:p(""),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert("Error sending message:\n".concat(JSON.stringify(e.t0)));case 13:return e.prev=13,y(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,10,13,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(R.jsxs)(m.a,{onSubmit:g,children:[Object(R.jsx)(m.a.Dropdown,{fluid:!0,search:!0,selection:!0,className:"select-request-receiver",placeholder:"Select who you want to process your request",options:t.map((function(e){return{key:e.username,text:e.username,value:e.username}})),value:a,onChange:function(e){var t;return s(null!==(t=e.currentTarget.textContent)&&void 0!==t?t:void 0)}}),Object(R.jsx)(m.a.Input,{className:"select-request-content",placeholder:"Request content",value:j,onChange:function(e){return p(e.currentTarget.value)}}),Object(R.jsx)(h.a,{fluid:!0,className:"select-request-send-button",type:"submit",disabled:v||void 0===a||""===j,loading:v,content:"Send"})]})},z=function(){var e,t,n=Object(q.useParty)(),r=null===(e=Object(q.useStreamFetchByKeys)(w.User.User,(function(){return[n]}),[n]).contracts[0])||void 0===e?void 0:e.payload,c=[{username:null===(t=Object(q.useFetchByKey)(w.User.User,(function(){return"Admin"}),[n]).contract)||void 0===t?void 0:t.key}];return Object(R.jsx)(A.a,{children:Object(R.jsx)(j.a,{centered:!0,columns:2,children:Object(R.jsx)(j.a.Row,{stretched:!0,children:Object(R.jsxs)(j.a.Column,{children:[Object(R.jsx)(p.a,{as:"h1",size:"huge",color:"blue",textAlign:"center",style:{padding:"1ex 0em 0ex 0em"},children:r?"Welcome, ".concat(r.username,"!"):"Loading..."}),Object(R.jsxs)(b.a,{children:[Object(R.jsxs)(p.a,{as:"h2",children:[Object(R.jsx)(_.a,{name:"pencil square"}),Object(R.jsxs)(p.a.Content,{children:["Requests",Object(R.jsx)(p.a.Subheader,{children:"Send a Request"})]})]}),Object(R.jsx)(T,{admins:c}),Object(R.jsx)(S.a,{}),Object(R.jsx)(L,{})]})]})})})})},B=function(e){var t=e.onLogout;return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(U.a,{icon:!0,borderless:!0,children:Object(R.jsxs)(U.a.Menu,{position:"right",className:"test-select-main-menu",children:[Object(R.jsxs)(U.a.Item,{position:"right",children:["You are logged in as ",Object(q.useParty)(),"."]}),Object(R.jsx)(U.a.Item,{position:"right",active:!1,className:"test-select-log-out",onClick:t,icon:"log out"})]})}),Object(R.jsx)(z,{})]})},C=function(){var e=o.a.useState(),t=Object(i.a)(e,2),n=t[0],r=t[1];return n?Object(R.jsx)(I.a,{token:n.token,party:n.party,httpBaseUrl:x,children:Object(R.jsx)(B,{onLogout:function(){return r(void 0)}})}):Object(R.jsx)(k,{onLogin:r})};u.a.render(Object(R.jsx)(C,{}),document.getElementById("root"))}},[[543,1,2]]]);
//# sourceMappingURL=main.103a0a64.chunk.js.map